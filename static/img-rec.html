<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- レスポンシブWebデザインを使うために必要なmetaタグ -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>test page</title>
  </head>
  

  <h1>AV Zeus</h1>
  <h2>画像レコメンドモード</h2>
  <body>
    
    <input type="file" id= "posted_image"  accept="image/png,image/jpeg,image/jpg" />
    <script type="text/javascript">
      async function postData(url = '', data = {}) {
    // 既定のオプションには * が付いています
    //const response = await 
    let response = await fetch(url, {
      method: 'POST', // *GET, POST, PUT, DELETE, etc.
      mode: 'cors', // no-cors, *cors, same-origin
      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
      credentials: 'include', // include, *same-origin, omit
      headers: {
        'Content-Type': 'application/json'

        // 'Content-Type': 'application/x-www-form-urlencoded',
      },
      redirect: 'follow', // manual, *follow, error
      referrerPolicy: 'strict-origin', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
      body: JSON.stringify(data) // 本文のデータ型は "Content-Type" ヘッダーと一致させる必要があります
    })
    
    //return JSON.parse(response.json()); // JSON のレスポンスをネイティブの JavaScript オブジェクトに解釈
    return JSON.parse(JSON.stringify(response)); 
  }
      document.getElementById("posted_image").addEventListener("change", function (e) {
        // 1枚だけ表示する
        var file = e.target.files[0];
        // ファイルリーダー作成
        var fileReader = new FileReader();
        fileReader.onload = function() {
          // Data URIを取得
          var dataUri = this.result;
          // img要素に表示
          var img = document.getElementById("render_image");
          var data = postData('https://nameless-sea-96924.herokuapp.com/api/v1/cut',
          { input_text: dataUri.replace(/data:.*\/.*;base64,/, '')}
          );
          console.log(data)
          img.src = dataUri;
        }
        // ファイルをData URIとして読み込む
        fileReader.readAsDataURL(file);}
      );
    </script>
    <img id="render_image">
  </body>
</html>